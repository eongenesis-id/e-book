<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator E-Book Sempoa China Asli</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #8B4513;
            --secondary: #D2B48C;
            --accent: #A52A2A;
            --light: #F5F5DC;
            --dark: #4B0082;
            --success: #228B22;
            --warning: #FF8C00;
            --danger: #B22222;
            --beam-color: #FF0000; /* Warna merah untuk beam */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #FAF0E6;
            color: #4B0082;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 20px 0;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            margin-right: 10px;
            font-size: 30px;
        }
        
        .app-title {
            text-align: center;
            margin: 20px 0;
            color: var(--dark);
        }
        
        .main-app {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        .editor-panel {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid var(--primary);
        }
        
        .preview-panel {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--primary);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .panel-header h2 {
            color: var(--dark);
        }
        
        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            margin-left: 10px;
        }
        
        .action-btn:hover {
            background: var(--accent);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-size: 16px;
            background-color: #FFF8DC;
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        .abacus-controls {
            background: #FFF8DC;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid var(--primary);
        }
        
        .input-section {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .number-input {
            width: 100px;
            padding: 10px;
            border: 2px solid var(--primary);
            border-radius: 5px;
            font-size: 18px;
            text-align: center;
        }
        
        .abacus-display {
            margin: 30px 0;
            text-align: center;
        }
        
        .traditional-abacus {
            width: 100%;
            max-width: 800px;
            height: 180px;
            margin: 0 auto;
            position: relative;
            overflow: visible;
            background: #8B4513;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .abacus-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #8B4513;
            border: 8px solid #A52A2A;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        .divider {
            position: absolute;
            width: 100%;
            height: 3px;
            background: var(--beam-color); /* Beam berwarna merah */
            z-index: 2;
        }
        
        .upper-divider {
            top: 30%;
        }
        
        .rod {
            position: absolute;
            height: 100%;
            width: 3px;
            background: #D2B48C;
            z-index: 3;
        }
        
        .bead {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            z-index: 4;
            transition: all 0.5s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .upper-bead {
            background: #FFD700;
            border: 2px solid #B8860B;
        }
        
        .lower-bead {
            background: #FF4500;
            border: 2px solid #8B0000;
        }
        
        .preview-content {
            padding: 20px;
        }
        
        .preview-item {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px dashed var(--primary);
        }
        
        .preview-abacus {
            text-align: center;
            margin: 20px 0;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: var(--dark);
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid var(--primary);
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: #FFF8DC;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--dark);
        }
        
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            padding: 20px;
            background: #FFF8DC;
            border-radius: 0 0 8px 8px;
            border: 2px solid var(--primary);
            border-top: none;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            border: 1px solid #ccc;
        }
        
        .page-break {
            page-break-after: always;
            border-top: 2px dashed #ccc;
            margin: 20px 0;
            padding: 10px;
            text-align: center;
            color: #666;
        }
        
        @media (max-width: 900px) {
            .a4-page {
                width: 100%;
                box-shadow: none;
            }
            
            .input-section {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">ðŸ§®</span>
                <span>Generator E-Book Sempoa China Asli</span>
            </div>
        </div>
    </header>

    <div class="container">
        <h1 class="app-title">Buat E-Book Sempoa dengan Desain China Asli</h1>
        
        <div class="main-app">
            <div class="editor-panel">
                <div class="panel-header">
                    <h2>Editor E-Book Sempoa</h2>
                    <div>
                        <button class="action-btn btn-danger" onclick="clearAll()">Bersihkan</button>
                        <button class="action-btn btn-success" onclick="generatePDF()">Download PDF</button>
                    </div>
                </div>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="openTab('tab1')">Informasi Buku</button>
                        <button class="tab-btn" onclick="openTab('tab2')">Konfigurasi Sempoa</button>
                        <button class="tab-btn" onclick="openTab('tab3')">Pratinjau Buku</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="tab1" class="tab-pane active">
                            <div class="form-group">
                                <label for="bookTitle">Judul Buku</label>
                                <input type="text" id="bookTitle" class="form-control" placeholder="Masukkan judul buku" value="Buku Belajar Sempoa China">
                            </div>
                            
                            <div class="form-group">
                                <label for="bookDescription">Deskripsi Buku</label>
                                <textarea id="bookDescription" class="form-control" placeholder="Tulis deskripsi buku Anda di sini...">Buku ini berisi materi pembelajaran sempoa tradisional China. Sempoa adalah alat hitung kuno yang terdiri dari bingkai kayu dengan manik-manik yang dapat digerakkan. Setiap tiang sempoa memiliki 4 manik di bagian bawah (mewakili nilai 1) dan 1 manik di bagian atas (mewakili nilai 5).</textarea>
                            </div>
                        </div>
                        
                        <div id="tab2" class="tab-pane">
                            <div class="form-group">
                                <label>Konfigurasi Sempoa</label>
                                <p>Masukkan nilai angka (0-9999999999) dan sistem akan menghasilkan representasi sempoa dengan desain China asli.</p>
                                
                                <div class="input-section">
                                    <div>
                                        <label for="numberInput">Masukkan Angka:</label>
                                        <input type="number" id="numberInput" class="number-input" min="0" max="9999999999" value="1234">
                                    </div>
                                    <button class="action-btn" onclick="updateAbacus()">Tampilkan Sempoa</button>
                                </div>
                                
                                <div class="abacus-display">
                                    <h3>Representasi Sempoa China Asli</h3>
                                    <div id="abacusDisplay" class="traditional-abacus">
                                        <!-- Sempoa akan di-generate oleh JavaScript -->
                                    </div>
                                    <p>Sempoa ini menunjukkan angka: <strong><span id="displayNumber">1234</span></strong></p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="abacusExplanation">Penjelasan Tambahan (Opsional):</label>
                                    <textarea id="abacusExplanation" class="form-control" placeholder="Tambahkan penjelasan tentang sempoa ini...">Perhatikan bagaimana setiap angka diwakili oleh kombinasi manik-manik pada setiap tiang. Angka 1-4 menggunakan manik bawah, angka 5 menggunakan manik atas, dan angka 6-9 menggunakan kombinasi manik atas dan bawah.</textarea>
                                </div>
                                
                                <button class="action-btn" onclick="addToBook()">Tambahkan ke Buku</button>
                            </div>
                        </div>
                        
                        <div id="tab3" class="tab-pane">
                            <div class="preview-content">
                                <div class="a4-page" id="bookPreview">
                                    <h1 id="previewTitle">Buku Belajar Sempoa China</h1>
                                    <div id="previewDescription">
                                        <p>Buku ini berisi materi pembelajaran sempoa tradisional China. Sempoa adalah alat hitung kuno yang terdiri dari bingkai kayu dengan manik-manik yang dapat digerakkan. Setiap tiang sempoa memiliki 4 manik di bagian bawah (mewakili nilai 1) dan 1 manik di bagian atas (mewakili nilai 5).</p>
                                    </div>
                                    
                                    <div id="bookContent">
                                        <!-- Konten buku akan diisi oleh JavaScript -->
                                    </div>
                                </div>
                                <div class="page-break">Halaman 2 (jika konten melebihi 1 halaman)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Â© 2023 Generator E-Book Sempoa China Asli</p>
    </footer>

    <script>
        // Variabel global
        let bookPages = [];
        let currentPageContent = [];
        
        // Inisialisasi saat halaman dimuat
        window.onload = function() {
            generateTraditionalAbacus('abacusDisplay', 1234);
            updatePreview();
        };
        
        // Fungsi untuk tab
        function openTab(tabId) {
            // Sembunyikan semua tab
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabPanes.forEach(tab => tab.classList.remove('active'));
            
            // Tampilkan tab yang dipilih
            document.getElementById(tabId).classList.add('active');
            
            // Update tab button
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Jika tab pratinjau, update preview
            if (tabId === 'tab3') {
                updatePreview();
            }
        }
        
        // Fungsi untuk menghasilkan sempoa tradisional China asli
        function generateTraditionalAbacus(containerId, number) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            // Bingkai sempoa (kayu dengan pinggiran tebal)
            const frame = document.createElement('div');
            frame.className = 'abacus-frame';
            container.appendChild(frame);
            
            // Pembatas horizontal (hanya satu di bagian atas)
            const upperDivider = document.createElement('div');
            upperDivider.className = 'divider upper-divider';
            container.appendChild(upperDivider);
            
            // Konversi angka menjadi digit (maksimal 10 digit)
            const numStr = String(number);
            const digits = numStr.padStart(10, '0').split('').map(Number);
            
            // Buat 10 tiang seperti sempoa China asli (dari kanan ke kiri)
            for (let i = 0; i < 10; i++) {
                const position = 5 + (i * 10); // 5%, 15%, 25%, ... 95%
                
                // Tiang
                const rod = document.createElement('div');
                rod.className = 'rod';
                rod.style.left = `${position}%`;
                container.appendChild(rod);
                
                const digitIndex = 9 - i; // Indeks digit: 9,8,7,...,0 (dari kiri ke kanan)
                const digit = digits[digitIndex];
                
                // Manik atas (1 biji, nilai 5) - di atas pembatas
                const upperBead = document.createElement('div');
                upperBead.className = 'bead upper-bead';
                
                // Jika nilai >= 5, manik aktif (diturunkan ke bawah) - TIDAK MELEWATI BEAM
                if (digit >= 5) {
                    upperBead.style.top = '35%'; // Diturunkan mendekati beam merah, tidak melewati
                } else {
                    upperBead.style.top = '15%'; // Posisi atas (normal)
                }
                
                upperBead.style.left = `calc(${position}% - 10px)`;
                container.appendChild(upperBead);
                
                // Manik bawah (4 biji, nilai 1 per manik) - di bawah pembatas
                for (let j = 0; j < 4; j++) {
                    const lowerBead = document.createElement('div');
                    lowerBead.className = 'bead lower-bead';
                    
                    // Posisi normal untuk beads bawah (tidak menyentuh bingkai bawah)
                    const normalPosition = 70 + j * 7;
                    
                    // Penanganan khusus untuk angka 1, 2, dan 3
                    if (digit === 1) {
                        // Angka 1: hanya 1 bead bawah yang mendekati beam merah
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 2) {
                        // Angka 2: 2 beads bawah mendekati beam merah, berjarak
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else if (j === 1) {
                            lowerBead.style.top = '62%'; // Dinaikkan dengan jarak
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 3) {
                        // Angka 3: 3 beads bawah mendekati beam merah, berjarak
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else if (j === 1) {
                            lowerBead.style.top = '62%'; // Dinaikkan dengan jarak
                        } else if (j === 2) {
                            lowerBead.style.top = '69%'; // Dinaikkan dengan jarak
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 0) {
                        // Angka 0: semua manik bawah di posisi normal
                        lowerBead.style.top = `${normalPosition}%`;
                    } else if (digit >= 5) {
                        // Untuk nilai 5-9, manik bawah mewakili (digit-5)
                        if (j < (digit - 5)) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else {
                        // Untuk nilai 4
                        if (j < digit) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    }
                    
                    lowerBead.style.left = `calc(${position}% - 10px)`;
                    container.appendChild(lowerBead);
                }
                
                // Label nilai tempat untuk tiang angka
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.bottom = '-25px';
                label.style.left = `calc(${position}% - 20px)`;
                label.style.width = '40px';
                label.style.textAlign = 'center';
                label.style.fontWeight = 'bold';
                label.style.color = '#4B0082';
                
                // Label satuan, puluhan, ratusan, dst. (dari kanan ke kiri)
                const placeValues = ['Milyaran', 'Ratus Juta', 'Puluh Juta', 'Jutaan', 'Ratus Ribu', 'Puluh Ribu', 'Ribuan', 'Ratusan', 'Puluhan', 'Satuan'];
                label.textContent = placeValues[i];
                
                container.appendChild(label);
                
                // Label nilai digit
                const digitLabel = document.createElement('div');
                digitLabel.style.position = 'absolute';
                digitLabel.style.bottom = '-45px';
                digitLabel.style.left = `calc(${position}% - 10px)`;
                digitLabel.style.width = '20px';
                digitLabel.style.textAlign = 'center';
                digitLabel.style.fontWeight = 'bold';
                digitLabel.style.background = '#4B0082';
                digitLabel.style.color = 'white';
                digitLabel.style.borderRadius = '50%';
                digitLabel.textContent = digit;
                
                container.appendChild(digitLabel);
            }
            
            // Update display number
            document.getElementById('displayNumber').textContent = number.toLocaleString();
        }
        
        // Update sempoa
        function updateAbacus() {
            const number = parseInt(document.getElementById('numberInput').value) || 0;
            if (number > 9999999999) {
                alert('Angka maksimal adalah 9,999,999,999');
                document.getElementById('numberInput').value = 9999999999;
                generateTraditionalAbacus('abacusDisplay', 9999999999);
            } else if (number < 0) {
                alert('Angka minimal adalah 0');
                document.getElementById('numberInput').value = 0;
                generateTraditionalAbacus('abacusDisplay', 0);
            } else {
                generateTraditionalAbacus('abacusDisplay', number);
            }
        }
        
        // Tambahkan ke buku
        function addToBook() {
            const number = parseInt(document.getElementById('numberInput').value) || 0;
            const explanation = document.getElementById('abacusExplanation').value;
            
            // Simpan konten halaman
            currentPageContent.push({
                number: number,
                explanation: explanation
            });
            
            alert('Sempoa telah ditambahkan ke buku! Buka tab Pratinjau Buku untuk melihat hasilnya.');
        }
        
        // Update pratinjau
        function updatePreview() {
            const title = document.getElementById('bookTitle').value || 'Buku Belajar Sempoa China';
            const description = document.getElementById('bookDescription').value || '';
            
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewDescription').innerHTML = description.replace(/\n/g, '<br>');
            
            // Update konten buku
            const bookContent = document.getElementById('bookContent');
            bookContent.innerHTML = '';
            
            if (currentPageContent.length === 0) {
                bookContent.innerHTML = '<p class="preview-item">Tambahkan beberapa sempoa melalui tab Konfigurasi Sempoa untuk melihat pratinjau di sini.</p>';
                return;
            }
            
            currentPageContent.forEach((item, index) => {
                const section = document.createElement('div');
                section.className = 'preview-item';
                section.innerHTML = `
                    <h3>Sempoa ${index + 1}</h3>
                    <div class="preview-abacus">
                        <div id="previewAbacus${index}" class="traditional-abacus" style="margin: 0 auto;"></div>
                    </div>
                    <p>${item.explanation}</p>
                `;
                
                bookContent.appendChild(section);
                
                // Generate sempoa untuk pratinjau
                setTimeout(() => {
                    generateTraditionalAbacus(`previewAbacus${index}`, item.number);
                }, 100);
            });
        }
        
        // Generate PDF
        function generatePDF() {
            // Validasi
            const title = document.getElementById('bookTitle').value;
            if (!title) {
                alert('Harap isi judul buku!');
                return;
            }
            
            if (currentPageContent.length === 0) {
                alert('Tambahkan setidaknya satu sempoa ke buku sebelum menggenerate PDF!');
                return;
            }
            
            // Gunakan html2canvas dan jsPDF untuk generate PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Tambahkan halaman judul
            doc.setFontSize(24);
            doc.text(title, 105, 50, { align: 'center' });
            doc.setFontSize(16);
            const description = document.getElementById('bookDescription').value;
            const splitDescription = doc.splitTextToSize(description, 150);
            doc.text(splitDescription, 105, 70, { align: 'center' });
            
            // Tambahkan halaman konten
            let page = 1;
            let yPosition = 30;
            
            currentPageContent.forEach((item, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    page++;
                    yPosition = 30;
                }
                
                doc.setFontSize(18);
                doc.text(`Sempoa ${index + 1}: Angka ${item.number.toLocaleString()}`, 20, yPosition);
                yPosition += 15;
                
                // Simpan sempoa sebagai gambar
                const abacusDiv = document.createElement('div');
                abacusDiv.className = 'traditional-abacus';
                abacusDiv.style.width = '400px';
                abacusDiv.style.height = '150px';
                document.body.appendChild(abacusDiv);
                
                generateTraditionalAbacusPreview(abacusDiv, item.number);
                
                setTimeout(() => {
                    html2canvas(abacusDiv).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        doc.addImage(imgData, 'PNG', 20, yPosition, 170, 80);
                        yPosition += 90;
                        
                        doc.setFontSize(12);
                        const splitExplanation = doc.splitTextToSize(item.explanation, 170);
                        doc.text(splitExplanation, 20, yPosition);
                        yPosition += splitExplanation.length * 7;
                        
                        document.body.removeChild(abacusDiv);
                        
                        if (index === currentPageContent.length - 1) {
                            // Simpan PDF
                            doc.save(`${title.replace(/\s+/g, '_')}.pdf`);
                            alert('PDF berhasil dihasilkan dan didownload!');
                        }
                    });
                }, 500);
            });
        }
        
        // Fungsi untuk generate sempoa untuk preview PDF
        function generateTraditionalAbacusPreview(container, number) {
            if (!container) return;
            
            container.innerHTML = '';
            
            // Bingkai sempoa
            const frame = document.createElement('div');
            frame.style.position = 'absolute';
            frame.style.top = '0';
            frame.style.left = '0';
            frame.style.width = '100%';
            frame.style.height = '100%';
            frame.style.background = '#8B4513';
            frame.style.border = '8px solid #A52A2A';
            frame.style.borderRadius = '5px';
            frame.style.boxSizing = 'border-box';
            container.appendChild(frame);
            
            // Pembatas horizontal (beam merah)
            const upperDivider = document.createElement('div');
            upperDivider.style.position = 'absolute';
            upperDivider.style.width = '100%';
            upperDivider.style.height = '3px';
            upperDivider.style.background = '#FF0000'; // Beam berwarna merah
            upperDivider.style.zIndex = '2';
            upperDivider.style.top = '30%';
            container.appendChild(upperDivider);
            
            // Konversi angka menjadi digit
            const numStr = String(number);
            const digits = numStr.padStart(10, '0').split('').map(Number);
            
            // Buat 10 tiang seperti sempoa China asli
            for (let i = 0; i < 10; i++) {
                const position = 5 + (i * 10); // 5%, 15%, 25%, ... 95%
                
                // Tiang
                const rod = document.createElement('div');
                rod.style.position = 'absolute';
                rod.style.height = '100%';
                rod.style.width = '3px';
                rod.style.background = '#D2B48C';
                rod.style.zIndex = '3';
                rod.style.left = `${position}%`;
                container.appendChild(rod);
                
                const digitIndex = 9 - i;
                const digit = digits[digitIndex];
                
                // Manik atas (1 biji, nilai 5)
                const upperBead = document.createElement('div');
                upperBead.style.position = 'absolute';
                upperBead.style.width = '20px';
                upperBead.style.height = '20px';
                upperBead.style.borderRadius = '50%';
                upperBead.style.zIndex = '4';
                upperBead.style.background = '#FFD700';
                upperBead.style.border = '2px solid #B8860B';
                upperBead.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.3)';
                
                if (digit >= 5) {
                    upperBead.style.top = '35%'; // Diturunkan mendekati beam merah, tidak melewati
                } else {
                    upperBead.style.top = '15%'; // Posisi atas (normal)
                }
                
                upperBead.style.left = `calc(${position}% - 10px)`;
                container.appendChild(uupperBead);
                
                // Manik bawah (4 biji, nilai 1 per manik)
                for (let j = 0; j < 4; j++) {
                    const lowerBead = document.createElement('div');
                    lowerBead.style.position = 'absolute';
                    lowerBead.style.width = '20px';
                    lowerBead.style.height = '20px';
                    lowerBead.style.borderRadius = '50%';
                    lowerBead.style.zIndex = '4';
                    lowerBead.style.background = '#FF4500';
                    lowerBead.style.border = '2px solid #8B0000';
                    lowerBead.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.3)';
                    
                    // Posisi normal untuk beads bawah (tidak menyentuh bingkai bawah)
                    const normalPosition = 70 + j * 7;
                    
                    // Penanganan khusus untuk angka 1, 2, dan 3
                    if (digit === 1) {
                        // Angka 1: hanya 1 bead bawah yang mendekati beam merah
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 2) {
                        // Angka 2: 2 beads bawah mendekati beam merah, berjarak
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else if (j === 1) {
                            lowerBead.style.top = '62%'; // Dinaikkan dengan jarak
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 3) {
                        // Angka 3: 3 beads bawah mendekati beam merah, berjarak
                        if (j === 0) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else if (j === 1) {
                            lowerBead.style.top = '62%'; // Dinaikkan dengan jarak
                        } else if (j === 2) {
                            lowerBead.style.top = '69%'; // Dinaikkan dengan jarak
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else if (digit === 0) {
                        // Angka 0: semua manik bawah di posisi normal
                        lowerBead.style.top = `${normalPosition}%`;
                    } else if (digit >= 5) {
                        // Untuk nilai 5-9, manik bawah mewakili (digit-5)
                        if (j < (digit - 5)) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    } else {
                        // Untuk nilai 4
                        if (j < digit) {
                            lowerBead.style.top = '55%'; // Dinaikkan mendekati beam merah
                        } else {
                            lowerBead.style.top = `${normalPosition}%`; // Posisi bawah (normal)
                        }
                    }
                    
                    lowerBead.style.left = `calc(${position}% - 10px)`;
                    container.appendChild(lowerBead);
                }
            }
        }
        
        // Bersihkan semua
        function clearAll() {
            if (confirm('Apakah Anda yakin ingin menghapus semua konten?')) {
                document.getElementById('bookTitle').value = '';
                document.getElementById('bookDescription').value = '';
                document.getElementById('numberInput').value = '0';
                document.getElementById('abacusExplanation').value = '';
                
                // Reset konten buku
                currentPageContent = [];
                
                // Reset sempoa
                generateTraditionalAbacus('abacusDisplay', 0);
                
                updatePreview();
            }
        }
    </script>
</body>
</html>
